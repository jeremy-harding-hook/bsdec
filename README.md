# bsdec
A tool for reading and writing binary save files used in certain programs

   GETTING STARTED
				
BsdecGui is a graphical interface for the command-line utilities Bsdec and
BsdecSchemaGen (on Linux these names are written in kebab-case). The name Bsdec
stands for Binary Savefile DECoder, which should already explain its purpose:
to aid in the reading and writing of savefiles for programs that employ a
recursive BinaryReader-based saving mechanism in .net.

In order to permit reading of these files, Bsdec translates them into either
XML or JSON, using a schema file generated by BsdecSchemaGen. Note that it does
require some info about the saving mechanism that you may need to decompile the
assembly to ascertain; check any applicable licenses before doing so.

The "Configuration" tab is the GUI interface for BsdecSchemaGen, as well as
containing some basic configuration fields for the program as a whole. The
"Json" and "Xml" tabs are minimalistic text editors for each of the two
formats. The text fields are linked, such that when you change a value in the
XML it will automatically be copied over to the JSON version and vice-versa.

Throughout the UI, "Import" and "Export" refer to importing and exporting to/
from the binary format. "Save" and "Open" are instead used to refer to human-
readable formats.

BsdecGui depends upon Bsdec and BsdecSchemaGen, which must be located in the
same directory as BsdecGui; however if it is enough to use Bsdec or
BsdecSchemaGen from the command line, there is no such limitation. Neither one
depends upon the other to function. This means that you could also just install
Bsdec on its own if you rely on an outside source for any new schema files.
This seperation of concerns also holds true when using BsdecGui; you can omit
the installation of either of the other programs if the related functionality
is unneeded.

   SCHEMA GENERATION

In BsdecGui, the schema generation can be carried out using the controls on the
left-hand side and bottom of the "Configuration" pane. Here is a list of the
fields:
-	Top-level class name: This is the name of the class as it appears in the
		source code responsible for saving. Example: "FooBar"
	
-	Write method name: The name of the top-level write method as it appears in
		the source code. Example: "ExportFoo"
	
-	Read method name: See above. Example: "ImportFoo"
	
-	Load schema: Whether the generated schema should automatically be set as
		the schema used thoughout by Bsdec in the current window. You can
		normally leave it checked unless you're halfway through editing a file
		when you have the sudden urge to generate some other schema.
	
-	Program filepath: The location of the assembly containing the saving code.
		Note that just because the files are produced by BarFooifier2000 that
		doesn't necessarily mean this will be BarFooifier2000.exe. It might be
		a dll or something instead. If you found the values of the read/write
		method names via decompilation, you should already know which file they
		are in. If not, ask whoever passed that info along to you which file to
		use. Example: "/some/long/path/to/a/downloaded/binary/FooBarSaving.dll"
	
-	Output filepath: If you'd like the schema to be saved somewhere in
		particular, enter that location here. Otherwise, a temp file will be
		created. For practical reasons, if you frequently edit save files for
		a single program, it may be best just to do the generation once and
		then save the schema somewhere.
		Example: "/some/simple/path/foo-bar-schema.dll"

This is unfortunately a little hit-or-miss, and if you're writing a program
with the intention of using Bsdec to read the files you may want to do some
testing fairly early on the the development cycle. At a technical level, the
basic requirements are that the top-level save and restore methods have a
first parameter of BinaryReader/Writer and all other parameters have default
values, and additionally the save mechanism cannot call methods from other
frameworks/libraries. An exception is made for logging methods, assuming
BsdecSchemaGen correctly identifies the method in question as such. When trying
it out, you may find it helpful to decompile the generated schema file. This is
really just a library containing pared-down copies of all the saved classes
along with the save methods and anything else required. Additionally, the top-
level class is marked with a BsdecToplevelSavefileClass attribute, and the top-
level reader and writer methods are identified with BsdecReadMethod and
BsdecWriteMethod attributes. These are defined in BsdecCore, so it's normal to
get decompilation warnings due to that. These warnings might be removable if
you convince your decompiler to reference the BsdecCore contained in either the
Bsdec or the BsdecSchemaGen assembly.

   EDITOR
				
The editor panes are fairly self-explanitory. There is continuous syncing
between the panes, but you can also force a sync with the "validate" button.
This button additionally refreshes the current pane, so you may see that
missing fields have been added back in with default values for instance.

"Save", "Save as" and "Open" all work as you might expect, saving the text in
the current pane. Hence if you save in the json pane you save json, and if you
save in the xml pane you save xml. That is why there are separate locations
listed under the "Configuration" tab in the box on the right-hand side.

"Import", "Reimport", "Export" and "Export as" export/import the binary
savefile. Note that there are separate directories for import and export. This
is to allow making multiple modifications on one base file, as well as making
it easy to test and revert changes that did not have the desired effect.

   CLOSING REMARKS
				
Logs can be found at C:\Users\username\AppData\Roaming\Bsdec\Logs on Windows
or ~/.config/bsdec/logs on Linux.
				
Information on the correct usage of Bsdec and BsdecSchemaGen can be obtained
using the -h or --help option in the command line.

The Bsdec suite of programs was hastily thrown together in mid-2023 by
Jeremy Harding Hook. The github page can be found at:
https://github.com/jeremy-harding-hook/bsdec/
Additionally, I can be contacted at jeremyhhook@gmail.com
Pull requests are always very welcome, change requests slightly less so, though
I may eventually get around to implementing a requested feature.

The recursive and largely functional architecture of Bsdec and BsdecSchemaGen
make me think they would be much better written in F#, but as at the time of
development I had yet to learn it and wanted to get the program done quickly I
opted to stick to C# instead. The architecture of BsdecGui could best be
described as a mess; it wasn't really big enough to warrant proper MVVM or
anything (no models, as all the heavy lifting is done by Bsdec).

All three programs are licensed under the GPL version 3.
(see https://www.gnu.org/licenses/)

BsdecGui uses the Avalonia UI framework, including Avalonia Edit for the
editors, as well as NLog for logging.
BsdecSchemaGen relies heavily on Mono.Cecil for reflecting the saving assembly
and creating the schema file.
